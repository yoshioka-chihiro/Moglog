<h1>食事登録</h1>

<%= form_with model: @meal, local:true do |f| %>
  <%= f.select :meal_type, Meal.meal_types_i18n.keys.map{|k| [I18n.t("enums.meal.meal_type.#{k}"), k]}, {prompt: '選択してください'} %>
  <%= f.time_select :recorded_at, {minute_step: 15} %>
  <br>
  <div id="album-track-forms">
    <%= f.fields_for :meal_details do |f| %>
      <%= render 'form', hoge: f %>
    <% end %>
  </div>
  <%# トラックの追加フォームをするボタン %>
  <%# 詳しいオプション : https://github.com/nathanvda/cocoon#link_to_add_association %>
  <%= link_to_add_association '＋別の食品を追加',
                              # form_withのformタグ変数
                              f,
                              # フォームのデータを追加するモデル名
                              :meal_details,
                              # 追加するフォームの部分テンプレート
                              partial: "form",
                              # オプション
                              data: {
                                # フォームを追加する場所の指定
                                association_insertion_node: '#album-track-forms',
                                # フォームを前後どの位置に追加するか。(初期値: before)
                                association_insertion_method: 'after'
                              },
                              # フォームオブジェクトを指定する場合(初期値 : f)
                              form_name: 'hoge',
                              # 部分テンプレートに渡す変数があれば記述
                              render_options: {
                                locals: {
                                  # 通常の部分テンプレートと同じ記述
                                }
                              }
  %>
  <br>
  <div class="field">
    <%= f.submit "登録する" %>
  </div>
<% end %>

<h1>今日の食事一覧</h1>
<% @meals.each do |meal| %>
  <%= meal.meal_type_i18n %>
  <%= meal.recorded_at.strftime('%H:%M') %>
  <% meal.meal_details.each do |d| %>
    <%= d.food.name %>
    <%= d.quantity %>
  <% end %>
  <%= link_to '削除', meal_path(meal.id), method: :delete %>
  <br>

<% end %>
</div>